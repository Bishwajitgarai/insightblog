{% extends "base.html" %}

{% block title %}Notifications - InsightBlog{% endblock %}

{% block content %}
<div class="container container-sm" style="padding: 2rem 0;">
    <h1 style="margin-bottom: 2rem;">Notifications</h1>

    <!-- Loading -->
    <div id="loading" class="text-center" style="padding: 2rem 0;">
        <div class="skeleton skeleton-text"></div>
        <div class="skeleton skeleton-text"></div>
        <div class="skeleton skeleton-text"></div>
    </div>

    <!-- Notifications Container -->
    <div id="notifications-container" class="flex flex-col gap-md" style="display: none;"></div>

    <!-- Empty State -->
    <div id="empty-state" class="card text-center" style="display: none; padding: 4rem 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üîî</div>
        <h3>No notifications yet</h3>
        <p class="text-muted">You're all caught up!</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Check authentication
    if (!authService.isAuthenticated()) {
        window.location.href = '/login?next=' + encodeURIComponent(window.location.pathname);
    }

    async function loadNotifications() {
        try {
            const response = await authService.apiCall('/api/v1/posts/notifications/');
            
            if (!response.ok) {
                throw new Error('Failed to load notifications');
            }
            
            const data = await response.json();
            
            document.getElementById('loading').style.display = 'none';
            
            if (!data.notifications || data.notifications.length === 0) {
                document.getElementById('empty-state').style.display = 'block';
                return;
            }
            
            renderNotifications(data.notifications);
            document.getElementById('notifications-container').style.display = 'flex';
        } catch (error) {
            console.error('Error loading notifications:', error);
            document.getElementById('loading').innerHTML = '<div class="card text-center"><p class="text-error">Error loading notifications</p></div>';
        }
    }

    function renderNotifications(notifications) {
        const container = document.getElementById('notifications-container');
        container.innerHTML = '';
        
        notifications.forEach(notif => {
            const icon = notif.type === 'like' ? '‚ù§Ô∏è' : notif.type === 'comment' ? 'üí¨' : 'üîÑ';
            const bgClass = notif.read ? '' : 'style="background: rgba(99, 102, 241, 0.1);"';
            
            const notifHtml = `
                <div class="card" ${bgClass}>
                    <div class="flex items-start gap-md">
                        <div style="font-size: 1.5rem;">${icon}</div>
                        <div style="flex: 1;">
                            <p>${notif.content}</p>
                            <p class="text-sm text-muted" style="margin-top: 0.25rem;">
                                ${new Date(notif.created_at).toLocaleString()}
                            </p>
                        </div>
                        ${notif.post_id ? `
                            <a href="/posts/${notif.post_id}" class="btn btn-ghost" style="padding: 0.5rem 1rem;">
                                View Post
                            </a>
                        ` : ''}
                    </div>
                </div>
            `;
            container.innerHTML += notifHtml;
        });
    }

    document.addEventListener('DOMContentLoaded', loadNotifications);
</script>
{% endblock %}

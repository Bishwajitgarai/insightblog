{% extends "base.html" %}

{% block title %}Notifications - InsightBlog{% endblock %}

{% block content %}
<div class="container mx-auto max-w-4xl">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-4xl font-bold neon-text">Notifications</h1>
        <a href="/dashboard" class="text-gray-400 hover:text-primary transition">‚Üê Back to Dashboard</a>
    </div>

    <div id="loading" class="text-center py-10">
        <p class="text-gray-500">Loading notifications...</p>
    </div>

    <div id="notifications-container" class="card hidden"></div>

    <div id="empty-state" class="hidden card text-center py-10">
        <p class="text-gray-500 text-lg">No notifications yet</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadNotifications() {
        try {
            const response = await authService.apiCall('/api/v1/posts/notifications/');
            const data = await response.json();
            
            document.getElementById('loading').classList.add('hidden');
            
            if (data.notifications.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            }
            
            renderNotifications(data.notifications);
            document.getElementById('notifications-container').classList.remove('hidden');
        } catch (error) {
            document.getElementById('loading').innerHTML = '<p class="text-red-500">Error loading notifications</p>';
        }
    }

    function renderNotifications(notifications) {
        const container = document.getElementById('notifications-container');
        container.innerHTML = '<div class="space-y-4"></div>';
        const list = container.querySelector('.space-y-4');
        
        notifications.forEach(notif => {
            const icon = notif.type === 'like' ? '‚ù§Ô∏è' : notif.type === 'comment' ? 'üí¨' : 'üîÑ';
            const bgClass = notif.read ? 'bg-gray-800/50' : 'bg-primary/10';
            
            const notifHtml = `
                <div class="flex items-start space-x-4 p-4 ${bgClass} rounded-lg">
                    <div class="flex-shrink-0 text-2xl">${icon}</div>
                    <div class="flex-1">
                        <p class="text-gray-300">${notif.content}</p>
                        <p class="text-xs text-gray-500 mt-1">${new Date(notif.created_at).toLocaleString()}</p>
                    </div>
                    ${notif.post_id ? `<a href="/posts/${notif.post_id}" class="text-sm text-primary hover:underline">View Post</a>` : ''}
                </div>
            `;
            list.innerHTML += notifHtml;
        });
    }

    document.addEventListener('DOMContentLoaded', loadNotifications);
</script>
{% endblock %}
